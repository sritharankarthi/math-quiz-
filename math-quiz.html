<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fun Maths Quiz</title>
  <style>
    :root{--bg:#f7fbff;--card:#fff;--accent:#4f46e5;--good:#16a34a;--bad:#ef4444}
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans',sans-serif}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#dff4ff 0%,var(--bg) 60%);display:flex;align-items:center;justify-content:center;padding:18px}
    .app{width:100%;max-width:900px}

    /* Start screen */
    .start{background:var(--card);padding:28px;border-radius:18px;box-shadow:0 8px 30px rgba(12,20,60,0.08);text-align:center}
    .logo{font-size:28px;font-weight:700;color:var(--accent);display:flex;gap:12px;align-items:center;justify-content:center}
    .logo .spark{width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,#ffd166,#ff6b6b);display:inline-flex;align-items:center;justify-content:center;font-size:22px}
    .start p{margin:10px 0 18px;color:#334155}
    .play-btn{display:inline-block;padding:12px 22px;border-radius:12px;background:linear-gradient(90deg,#4f46e5,#7c3aed);color:white;font-weight:700;border:none;cursor:pointer;font-size:18px;box-shadow:0 8px 20px rgba(79,70,229,0.25)}
    .lang-switch{position:absolute;right:20px;top:20px}

    /* Quiz card */
    .card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 8px 30px rgba(12,20,60,0.06)}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .stars{display:flex;gap:6px;align-items:center}
    .star{font-size:18px}
    .level{font-weight:700;color:#0f172a}
    .question{font-size:20px;margin:6px 0 14px;color:#0f172a}
    .options{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .opt{padding:12px;border-radius:10px;border:2px solid rgba(15,23,42,0.06);cursor:pointer;background:linear-gradient(180deg,#fff,#fbfdff);font-weight:600}
    .opt.disabled{pointer-events:none;opacity:0.7}

    /* feedback animations */
    .feedback{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);font-size:96px;pointer-events:none}
    .feedback.show{animation:pop .6s forwards}
    .feedback.good{color:var(--good)}
    .feedback.bad{color:var(--bad)}
    @keyframes pop{0%{transform:translate(-50%,-50%) scale(0)}60%{transform:translate(-50%,-50%) scale(1.12)}100%{transform:translate(-50%,-50%) scale(1)} }

    /* Gameover */
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center}
    .overlay.show{display:flex}
    .modal{background:var(--card);padding:20px;border-radius:14px;box-shadow:0 20px 60px rgba(2,6,23,0.25);text-align:center}

    /* misc */
    .small{font-size:13px;color:#475569}
    .controls{display:flex;gap:8px;align-items:center}

    @media (max-width:640px){.options{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="app">

    <!-- language switcher top-right -->
    <div style="position:relative">
      <div class="lang-switch">
        <select id="lang" aria-label="language">
          <option value="en">English</option>
          <option value="ta">தமிழ்</option>
        </select>
      </div>
    </div>

    <!-- Start screen -->
    <div id="startScreen" class="start">
      <div class="logo"><div class="spark">✦</div><div id="appTitle">Fun Maths Quiz</div></div>
      <p id="appSubtitle">Learn, play & level up — perfect for kids!</p>
      <div style="display:flex;gap:12px;justify-content:center;align-items:center">
        <button class="play-btn" id="startBtn">Start Game</button>
      </div>
      <p class="small" style="margin-top:12px">Wrong 3 times → Game over. 20 stars to level up.</p>
    </div>

    <!-- Quiz screen (hidden until start) -->
    <div id="quizScreen" style="display:none;margin-top:16px">
      <div class="card">
        <div class="meta">
          <div class="level" id="levelName">Level: Junior</div>
          <div class="stars" id="starBar"></div>
        </div>
        <div class="question" id="questionText">Question text</div>
        <div class="options" id="options"></div>
        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
          <div class="small">Mistakes: <span id="wrongCount">0</span>/3</div>
          <div class="controls"><button id="nextBtn" style="display:none">Next</button><button id="quitBtn" class="small">Quit</button></div>
        </div>
      </div>
    </div>

    <!-- feedback icons -->
    <div id="feedbackGood" class="feedback good">✅</div>
    <div id="feedbackBad" class="feedback bad">❎</div>

    <!-- overlay modal -->
    <div id="overlay" class="overlay">
      <div class="modal">
        <h2 id="overlayTitle">Game Over</h2>
        <p id="overlayMsg">You've used 3 mistakes. Try again!</p>
        <div style="margin-top:12px"><button id="restartBtn" class="play-btn">Play Again</button></div>
      </div>
    </div>

  </div>

  <script>
    /* --- Configuration --- */
    const LEVELS = ['Junior','Senior','Master','Grandmaster','Legend'];
    const LEVELS_TA = ['ஜூனியர்','சீனியர்','மாஸ்டர்','கிராண்ட் மாஸ்டர்','லெஜெண்ட்'];
    const STARS_PER_LEVEL = 20;
    const MAX_WRONG = 3;

    // Sample questions. To expand to 500+, load an external JSON file or paste many objects here.
    // Each question: {id, q: {en,ta}, opts: [{en,ta,value}], answerIndex}
    const QUESTIONS = [
  {
    "question": "Q1: 1 + 6 = ?",
    "options": [
      "6",
      "7",
      "8",
      "9"
    ],
    "answer": "7"
  },
  {
    "question": "Q2: 2 + 7 = ?",
    "options": [
      "8",
      "9",
      "10",
      "11"
    ],
    "answer": "9"
  },
  {
    "question": "Q3: 3 + 8 = ?",
    "options": [
      "10",
      "11",
      "12",
      "13"
    ],
    "answer": "11"
  },
  {
    "question": "Q4: 4 + 9 = ?",
    "options": [
      "12",
      "13",
      "14",
      "15"
    ],
    "answer": "13"
  },
  {
    "question": "Q5: 5 + 10 = ?",
    "options": [
      "14",
      "15",
      "16",
      "17"
    ],
    "answer": "15"
  },
  {
    "question": "Q6: 6 + 11 = ?",
    "options": [
      "16",
      "17",
      "18",
      "19"
    ],
    "answer": "17"
  },
  {
    "question": "Q7: 7 + 12 = ?",
    "options": [
      "18",
      "19",
      "20",
      "21"
    ],
    "answer": "19"
  },
  {
    "question": "Q8: 8 + 13 = ?",
    "options": [
      "20",
      "21",
      "22",
      "23"
    ],
    "answer": "21"
  },
  {
    "question": "Q9: 9 + 14 = ?",
    "options": [
      "22",
      "23",
      "24",
      "25"
    ],
    "answer": "23"
  },
  {
    "question": "Q10: 10 + 15 = ?",
    "options": [
      "24",
      "25",
      "26",
      "27"
    ],
    "answer": "25"
  },
  {
    "question": "Q11: 11 + 16 = ?",
    "options": [
      "26",
      "27",
      "28",
      "29"
    ],
    "answer": "27"
  },
  {
    "question": "Q12: 12 + 17 = ?",
    "options": [
      "28",
      "29",
      "30",
      "31"
    ],
    "answer": "29"
  },
  {
    "question": "Q13: 13 + 18 = ?",
    "options": [
      "30",
      "31",
      "32",
      "33"
    ],
    "answer": "31"
  },
  {
    "question": "Q14: 14 + 19 = ?",
    "options": [
      "32",
      "33",
      "34",
      "35"
    ],
    "answer": "33"
  },
  {
    "question": "Q15: 15 + 20 = ?",
    "options": [
      "34",
      "35",
      "36",
      "37"
    ],
    "answer": "35"
  },
  {
    "question": "Q16: 16 + 21 = ?",
    "options": [
      "36",
      "37",
      "38",
      "39"
    ],
    "answer": "37"
  },
  {
    "question": "Q17: 17 + 22 = ?",
    "options": [
      "38",
      "39",
      "40",
      "41"
    ],
    "answer": "39"
  },
  {
    "question": "Q18: 18 + 23 = ?",
    "options": [
      "40",
      "41",
      "42",
      "43"
    ],
    "answer": "41"
  },
  {
    "question": "Q19: 19 + 24 = ?",
    "options": [
      "42",
      "43",
      "44",
      "45"
    ],
    "answer": "43"
  },
  {
    "question": "Q20: 20 + 25 = ?",
    "options": [
      "44",
      "45",
      "46",
      "47"
    ],
    "answer": "45"
  },
  {
    "question": "Q21: 15 - 10 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q22: 16 - 11 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q23: 17 - 12 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q24: 18 - 13 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q25: 19 - 14 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q26: 20 - 15 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q27: 21 - 16 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q28: 22 - 17 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q29: 23 - 18 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q30: 24 - 19 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q31: 25 - 20 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q32: 26 - 21 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q33: 27 - 22 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q34: 28 - 23 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q35: 29 - 24 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q36: 30 - 25 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q37: 31 - 26 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q38: 32 - 27 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q39: 33 - 28 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q40: 34 - 29 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q41: 2 \u00d7 4 = ?",
    "options": [
      "6",
      "8",
      "10",
      "12"
    ],
    "answer": "8"
  },
  {
    "question": "Q42: 3 \u00d7 5 = ?",
    "options": [
      "13",
      "15",
      "17",
      "19"
    ],
    "answer": "15"
  },
  {
    "question": "Q43: 4 \u00d7 6 = ?",
    "options": [
      "22",
      "24",
      "26",
      "28"
    ],
    "answer": "24"
  },
  {
    "question": "Q44: 5 \u00d7 7 = ?",
    "options": [
      "33",
      "35",
      "37",
      "39"
    ],
    "answer": "35"
  },
  {
    "question": "Q45: 6 \u00d7 8 = ?",
    "options": [
      "46",
      "48",
      "50",
      "52"
    ],
    "answer": "48"
  },
  {
    "question": "Q46: 7 \u00d7 9 = ?",
    "options": [
      "61",
      "63",
      "65",
      "67"
    ],
    "answer": "63"
  },
  {
    "question": "Q47: 8 \u00d7 10 = ?",
    "options": [
      "78",
      "80",
      "82",
      "84"
    ],
    "answer": "80"
  },
  {
    "question": "Q48: 9 \u00d7 11 = ?",
    "options": [
      "97",
      "99",
      "101",
      "103"
    ],
    "answer": "99"
  },
  {
    "question": "Q49: 10 \u00d7 12 = ?",
    "options": [
      "118",
      "120",
      "122",
      "124"
    ],
    "answer": "120"
  },
  {
    "question": "Q50: 11 \u00d7 13 = ?",
    "options": [
      "141",
      "143",
      "145",
      "147"
    ],
    "answer": "143"
  },
  {
    "question": "Q51: 4 \u00f7 2 = ?",
    "options": [
      "1",
      "2",
      "3",
      "4"
    ],
    "answer": "2"
  },
  {
    "question": "Q52: 6 \u00f7 2 = ?",
    "options": [
      "2",
      "3",
      "4",
      "5"
    ],
    "answer": "3"
  },
  {
    "question": "Q53: 8 \u00f7 2 = ?",
    "options": [
      "3",
      "4",
      "5",
      "6"
    ],
    "answer": "4"
  },
  {
    "question": "Q54: 10 \u00f7 2 = ?",
    "options": [
      "4",
      "5",
      "6",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q55: 12 \u00f7 2 = ?",
    "options": [
      "5",
      "6",
      "7",
      "8"
    ],
    "answer": "6"
  },
  {
    "question": "Q56: 14 \u00f7 2 = ?",
    "options": [
      "6",
      "7",
      "8",
      "9"
    ],
    "answer": "7"
  },
  {
    "question": "Q57: 16 \u00f7 2 = ?",
    "options": [
      "7",
      "8",
      "9",
      "10"
    ],
    "answer": "8"
  },
  {
    "question": "Q58: 18 \u00f7 2 = ?",
    "options": [
      "8",
      "9",
      "10",
      "11"
    ],
    "answer": "9"
  },
  {
    "question": "Q59: 20 \u00f7 2 = ?",
    "options": [
      "9",
      "10",
      "11",
      "12"
    ],
    "answer": "10"
  },
  {
    "question": "Q60: 22 \u00f7 2 = ?",
    "options": [
      "10",
      "11",
      "12",
      "13"
    ],
    "answer": "11"
  },
  {
    "question": "Q61: 2^3 = ?",
    "options": [
      "8",
      "9",
      "7",
      "10"
    ],
    "answer": "8"
  },
  {
    "question": "Q62: 4^3 = ?",
    "options": [
      "64",
      "65",
      "63",
      "66"
    ],
    "answer": "64"
  },
  {
    "question": "Q63: 6^3 = ?",
    "options": [
      "216",
      "217",
      "215",
      "218"
    ],
    "answer": "216"
  },
  {
    "question": "Q64: 8^3 = ?",
    "options": [
      "512",
      "513",
      "511",
      "514"
    ],
    "answer": "512"
  },
  {
    "question": "Q65: 10^3 = ?",
    "options": [
      "1000",
      "1001",
      "999",
      "1002"
    ],
    "answer": "1000"
  },
  {
    "question": "Q66: \u221a4 = ?",
    "options": [
      "2",
      "3",
      "1",
      "4"
    ],
    "answer": "2"
  },
  {
    "question": "Q67: \u221a9 = ?",
    "options": [
      "3",
      "4",
      "2",
      "5"
    ],
    "answer": "3"
  },
  {
    "question": "Q68: \u221a16 = ?",
    "options": [
      "4",
      "5",
      "3",
      "6"
    ],
    "answer": "4"
  },
  {
    "question": "Q69: \u221a25 = ?",
    "options": [
      "5",
      "6",
      "4",
      "7"
    ],
    "answer": "5"
  },
  {
    "question": "Q70: \u221a36 = ?",
    "options": [
      "6",
      "7",
      "5",
      "8"
    ],
    "answer": "6"
  },
  {
    "question": "Q71: \u221a49 = ?",
    "options": [
      "7",
      "8",
      "6",
      "9"
    ],
    "answer": "7"
  },
  {
    "question": "Q72: \u221a64 = ?",
    "options": [
      "8",
      "9",
      "7",
      "10"
    ],
    "answer": "8"
  },
  {
    "question": "Q73: \u221a81 = ?",
    "options": [
      "9",
      "10",
      "8",
      "11"
    ],
    "answer": "9"
  },
  {
    "question": "Q74: \u221a100 = ?",
    "options": [
      "10",
      "11",
      "9",
      "12"
    ],
    "answer": "10"
  },
  {
    "question": "Q75: Approximate value of \u03c0 = ?",
    "options": [
      "3.14",
      "3.15",
      "3.10",
      "3.00"
    ],
    "answer": "3.14"
  },
  {
    "question": "Q76: Circumference of a circle with radius 7? (\u03c0=22/7)",
    "options": [
      "44",
      "42",
      "40",
      "50"
    ],
    "answer": "44"
  },
  {
    "question": "Q77: 6\u00b2 = ?",
    "options": [
      "36",
      "37",
      "35",
      "38"
    ],
    "answer": "36"
  },
  {
    "question": "Q78: 7\u00b2 = ?",
    "options": [
      "49",
      "50",
      "48",
      "51"
    ],
    "answer": "49"
  },
  {
    "question": "Q79: 8\u00b2 = ?",
    "options": [
      "64",
      "65",
      "63",
      "66"
    ],
    "answer": "64"
  },
  {
    "question": "Q80: 9\u00b2 = ?",
    "options": [
      "81",
      "82",
      "80",
      "83"
    ],
    "answer": "81"
  },
  {
    "question": "Q81: 10\u00b2 = ?",
    "options": [
      "100",
      "101",
      "99",
      "102"
    ],
    "answer": "100"
  },
  {
    "question": "Q82: 11\u00b2 = ?",
    "options": [
      "121",
      "122",
      "120",
      "123"
    ],
    "answer": "121"
  },
  {
    "question": "Q83: 3\u00b3 = ?",
    "options": [
      "27",
      "28",
      "26",
      "29"
    ],
    "answer": "27"
  },
  {
    "question": "Q84: 4\u00b3 = ?",
    "options": [
      "64",
      "65",
      "63",
      "66"
    ],
    "answer": "64"
  },
  {
    "question": "Q85: 5\u00b3 = ?",
    "options": [
      "125",
      "126",
      "124",
      "127"
    ],
    "answer": "125"
  },
  {
    "question": "Q86: 6\u00b3 = ?",
    "options": [
      "216",
      "217",
      "215",
      "218"
    ],
    "answer": "216"
  },
  {
    "question": "Q87: 7\u00b3 = ?",
    "options": [
      "343",
      "344",
      "342",
      "345"
    ],
    "answer": "343"
  },
  {
    "question": "Q88: 8\u00b3 = ?",
    "options": [
      "512",
      "513",
      "511",
      "514"
    ],
    "answer": "512"
  },
  {
    "question": "Q89: Area of square with side 5?",
    "options": [
      "25",
      "20",
      "15",
      "30"
    ],
    "answer": "25"
  },
  {
    "question": "Q90: Area of rectangle with length 10 and breadth 4?",
    "options": [
      "40",
      "30",
      "20",
      "50"
    ],
    "answer": "40"
  },
  {
    "question": "Q91: Area of triangle base 6 and height 8?",
    "options": [
      "24",
      "26",
      "30",
      "36"
    ],
    "answer": "24"
  },
  {
    "question": "Q92: Volume of cube side 3?",
    "options": [
      "27",
      "18",
      "36",
      "30"
    ],
    "answer": "27"
  },
  {
    "question": "Q93: Perimeter of square with side 9?",
    "options": [
      "36",
      "30",
      "25",
      "40"
    ],
    "answer": "36"
  },
  {
    "question": "Q94: Volume of cuboid 4\u00d73\u00d72?",
    "options": [
      "24",
      "30",
      "28",
      "32"
    ],
    "answer": "24"
  },
  {
    "question": "Q95: Solve: (12 + 8) \u00f7 5 = ?",
    "options": [
      "4",
      "5",
      "6",
      "3"
    ],
    "answer": "4"
  },
  {
    "question": "Q96: If 2x = 10, x = ?",
    "options": [
      "2",
      "3",
      "5",
      "10"
    ],
    "answer": "5"
  },
  {
    "question": "Q97: 15% of 200 = ?",
    "options": [
      "25",
      "30",
      "35",
      "40"
    ],
    "answer": "30"
  },
  {
    "question": "Q98: 2/5 of 100 = ?",
    "options": [
      "20",
      "30",
      "40",
      "50"
    ],
    "answer": "40"
  }
]


    /* --- State --- */
    let lang = localStorage.getItem('quiz_lang') || 'en';
    let currentLevel = parseInt(localStorage.getItem('quiz_level')||0,10);
    let starsInLevel = parseInt(localStorage.getItem('quiz_stars')||0,10);
    let wrongCount = 0;
    let questionIndex = 0;
    let shuffled = [];

    /* --- DOM --- */
    const langSelect = document.getElementById('lang');
    const startBtn = document.getElementById('startBtn');
    const startScreen = document.getElementById('startScreen');
    const quizScreen = document.getElementById('quizScreen');
    const questionText = document.getElementById('questionText');
    const optionsEl = document.getElementById('options');
    const levelName = document.getElementById('levelName');
    const starBar = document.getElementById('starBar');
    const wrongCountEl = document.getElementById('wrongCount');
    const feedbackGood = document.getElementById('feedbackGood');
    const feedbackBad = document.getElementById('feedbackBad');
    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlayMsg = document.getElementById('overlayMsg');
    const restartBtn = document.getElementById('restartBtn');
    const quitBtn = document.getElementById('quitBtn');

    // init
    function initUI(){
      langSelect.value = lang;
      updateLangTexts();
      renderStars();
      levelName.textContent = getLevelName();
      wrongCountEl.textContent = wrongCount;
    }

    function getLevelName(){return lang==='ta'?LEVELS_TA[currentLevel] || LEVELS_TA[LEVELS_TA.length-1]:LEVELS[currentLevel] || LEVELS[LEVELS.length-1];}

    function updateLangTexts(){
      document.getElementById('appTitle').textContent = lang==='ta' ? 'குறைந்த கணிதம்' : 'Fun Maths Quiz';
      document.getElementById('appSubtitle').textContent = lang==='ta' ? 'கற்றுக்கொள், விளையாடு, முன்னேறு!' : 'Learn, play & level up — perfect for kids!';
      startBtn.textContent = lang==='ta' ? 'போடுங்கள்' : 'Start Game';
      overlayTitle.textContent = lang==='ta' ? 'விளையாட்டு முடிந்தது' : 'Game Over';
      overlayMsg.textContent = lang==='ta' ? 'நீங்கள் 3 தவறுகளை பயன்படுத்தியுள்ளீர்கள். மீண்டும் முயற்சிக்கவும்!' : "You've used 3 mistakes. Try again!";
      document.getElementById('levelName').textContent = (lang==='ta' ? 'நிலை: ' : 'Level: ') + getLevelName();
    }

    // shuffle questions
    function shuffleQuestions(){
      shuffled = QUESTIONS.slice();
      for(let i=shuffled.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]]}
      questionIndex = 0;
    }

    function renderQuestion(){
      const q = shuffled[questionIndex % shuffled.length];
      questionText.textContent = q.q[lang] || q.q.en;
      optionsEl.innerHTML = '';
      q.opts.forEach((o, idx)=>{
        const btn = document.createElement('button');
        btn.className='opt';
        btn.innerText = o[lang] || o.en;
        btn.onclick = ()=>selectOption(idx,btn,q.answerIndex);
        optionsEl.appendChild(btn);
      })
    }

    function selectOption(idx,btn,answerIndex){
      // disable options
      document.querySelectorAll('.opt').forEach(x=>x.classList.add('disabled'));
      if(idx===answerIndex){
        showFeedback(true);
        starsInLevel += 1;
        saveProgress();
        renderStars();
        // check level up
        if(starsInLevel>=STARS_PER_LEVEL){
          starsInLevel = starsInLevel - STARS_PER_LEVEL;
          currentLevel = Math.min(currentLevel+1, LEVELS.length-1);
          levelName.textContent = (lang==='ta' ? 'நிலை: ' : 'Level: ') + getLevelName();
          saveProgress();
          setTimeout(()=>alert((lang==='ta'? 'நீங்கள் அடுத்த நிலைக்கு மேலே சென்றீர்கள்!':'You leveled up!')) ,200);
        }
      } else {
        showFeedback(false);
        wrongCount +=1;
        wrongCountEl.textContent = wrongCount;
        if(wrongCount>=MAX_WRONG){
          // game over
          setTimeout(()=>showGameOver(),600);
          return;
        }
      }
      // move next after short delay
      setTimeout(()=>{questionIndex++;renderQuestion();document.querySelectorAll('.opt').forEach(x=>x.classList.remove('disabled'))},700);
    }

    function showFeedback(good){
      const el = good? feedbackGood : feedbackBad;
      el.classList.remove('show');
      void el.offsetWidth; // reflow
      el.classList.add('show');
      setTimeout(()=>el.classList.remove('show'),700);
    }

    function renderStars(){
      starBar.innerHTML='';
      for(let i=0;i<STARS_PER_LEVEL;i++){
        const span = document.createElement('div');
        span.className='star';
        span.textContent = i < starsInLevel ? '⭐' : '☆';
        starBar.appendChild(span);
      }
    }

    function saveProgress(){
      localStorage.setItem('quiz_lang',lang);
      localStorage.setItem('quiz_level',String(currentLevel));
      localStorage.setItem('quiz_stars',String(starsInLevel));
    }

    function showGameOver(){
      overlay.classList.add('show');
    }

    function resetGame(){
      wrongCount = 0;
      wrongCountEl.textContent = wrongCount;
      starsInLevel = 0;
      currentLevel = 0;
      saveProgress();
      renderStars();
      overlay.classList.remove('show');
      startScreen.style.display='block';
      quizScreen.style.display='none';
    }

    // start
    startBtn.addEventListener('click',()=>{
      startScreen.style.display='none';
      quizScreen.style.display='block';
      wrongCount = 0; wrongCountEl.textContent = wrongCount;
      shuffleQuestions();
      renderQuestion();
    });

    restartBtn.addEventListener('click',()=>{
      overlay.classList.remove('show');
      startScreen.style.display='block';
      quizScreen.style.display='none';
    });

    quitBtn.addEventListener('click',()=>{
      if(confirm(lang==='ta' ? 'வெளியேற விரும்புகிறீர்களா?' : 'Quit game?')){
        startScreen.style.display='block';
        quizScreen.style.display='none';
        saveProgress();
      }
    });

    langSelect.addEventListener('change',(e)=>{
      lang = e.target.value;
      saveProgress();
      updateLangTexts();
      renderQuestion();
      renderStars();
    });

    // allow loading external questions: place a file questions.json next to this html and call loadExternalQuestions()
    async function loadExternalQuestions(){
      try{
        const res = await fetch('questions.json');
        if(!res.ok) return;
        const data = await res.json();
        if(Array.isArray(data) && data.length>0){
          // expected same schema as QUESTIONS
          QUESTIONS.length = 0; data.forEach(q=>QUESTIONS.push(q));
          shuffleQuestions();
        }
      }catch(e){console.warn('no external questions',e)}
    }

    // initialize UI
    initUI();
    // uncomment to auto-load questions.json if present
    // loadExternalQuestions();

  </script>
</body>
</html>


